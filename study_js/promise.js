'use strict';
//Promiseëž€?
//ì•½ì†ì´ë¼ëŠ” ë‹¨ì–´ë¡œ ìžë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì œê³µí•˜ëŠ” ë¹„ë™ê¸°ë¥¼ ê°„íŽ¸í•˜ê²Œ ì²˜ë¦¬í• ìˆ˜ ìžˆë„ë¡ ë„ì™€ì£¼ëŠ” ì˜¤ë¸Œì íŠ¸ë¡œ ì •í•´ì§„ ìž¥ì‹œê°„ì— ê¸°ëŠ¥ì„ ìˆ˜í–‰ì„ í•˜ê³ ë‚˜ì„œ ì •ìƒì ìœ¼ë¡œ ê¸°ëŠ¥ì´ ìˆ˜í–‰ë˜ë©´ ì„±ê³µì— ë©”ì„¸ì§€ì™€ í•¨ê»˜ ì²˜ë¦¬ëœ ê²°ê³¼ê°’ì„ ì „ë‹¬í•´ì£¼ê³  ë§Œì•½ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ ì˜ˆìƒí•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì—ëŸ¬ë¥¼ ì „ë‹¬í•´ ì¤ë‹ˆë‹¤. 
//ì˜ˆë¥¼ ë“¤ë©´ ë¯¸ë¦¬ ìˆ˜ì—…ì„ ë“±ë¡í•´ ë†“ê³  ë‚˜ì„œ ë‚˜ì¤‘ì— ê·¸ ìˆ˜ì—…ì´ ì—´ë¦¬ë©´ ë‚˜ì¤‘ì— ìˆ˜ì—…ì´ ì˜¤í”ˆí–ˆë‹¤ê³  ë©”ì¼ë¡œ ì „ë‹¬ì´ ì˜¤ê³  í™•ì¸í• ìˆ˜ ìžˆë‹¤.
//ë§Œì•½ ìˆ˜ì—… ì˜¤í”ˆë‚  ê°€ìž…í–ˆë‹¤ë©´ ë°”ë¡œ ê°•ì˜ì— ëŒ€í•œ ë©”ì¼ì´ ì˜¨ë‹¤.  ì´ë ‡ê²Œ ì‰½ê²Œ ì˜ˆë¥¼ ë“¤ìˆ˜ê°€ ìžˆë‹¤.

//ì½”ë“œë¥¼ ë³´ë©´ì„œ ì–´ë–»ê²Œ Promiseë¥¼ í™œìš©í•´ì„œ ì½œë°±í•¨ìˆ˜ë¥¼ ëŒ€ì²˜í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¡œ ë¹„ë™ê¸° ì½”ë“œë¥¼ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í• ìˆ˜ ìžˆëŠ”ì§€ ë³´ìž.
// Promise is a JavaScript object for asynchronous operation.
// State(ìƒíƒœ): pending(Promiseê°€ ë§Œë“¤ì–´ ì ¸ì„œ ìš°ë¦¬ê°€ ì§€ì •í•œ operationì´ ìˆ˜í–‰ì¤‘ì¼ ë•Œ ) -> fulfilled(operationì„ ì„±ê³µì ìœ¼ë¡œ ëë‚´ê²Œ ë˜ë©´ ë‚˜ì˜¤ê³ ) or rejected(íŒŒì¼ì„ ì°¾ì„ìˆ˜ ì—†ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ì— ë¬¸ì œê°€ ìƒê¸°ë©´ ë‚˜íƒ€ë‚œë‹¤)
// Producer(ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ì„œ í•´ë‹¹ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ ë‚´ëŠ”ê²ƒ) vs Consumer(ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì†Œë¹„í•˜ëŠ”ê²ƒ)

// 1. Producer 
// when new Promise is created, the executor runs automatically.
//ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” Promiseë§Œë“¤ê¸°
//PromiseëŠ” í´ëž˜ìŠ¤ë¡œ í™œìš©ëœë‹¤. NEWë¼ëŠ” í‚¤ì›Œë“œë¥¼ í™œìš©í•´ì„œ ì˜¤ë¸Œì íŠ¸ ìƒì„±ì´ ê°€ëŠ¥í•˜ë‹¤
//rejectê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ ë¬¸ì œê°€ ìƒê¸°ë©´ í˜¸ì¶œí•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤
//Promiseë¥¼ ë§Œë“œëŠ” ìˆ®ã„´ê°€ ìš°ë¦¬ë‹¤ ì „ë‹¬í•œ 
const promise = new Promise((resolve, reject) => {
    //resolve:ê¸°ëŠ¥ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•´ì„œ ë§ˆì§€ë§‰ì— ìµœì¢… ì „ë‹¬í•˜ëŠ” ê²ƒ 
    //reject: ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ ì¤‘ê°„ì— ë¬¸ì œ ìƒê¸°ë©´ í˜¸ì¶œí•˜ëŠ” ê²ƒ 
    // promise ì•ˆì—ì„œëŠ” ì¢€ë” í° ë°ì´í„°ë¥¼ ëŒë ¤ì„œ í•˜ëŠ” ì¼ë“¤ì„ í•œë‹¤. ì™œëƒí•˜ë©´ ìš°ë¦¬ê°€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ê±°ë‚˜ íŒŒì¼ì—ì„œ ë¬´ì–¸ê°€ í° ë°ì´í„°ë¥¼ ì½ëŠ” ê³¼ì •ì€ ì‹œê°„ì´ ê±¸ë¦¬ëŠ”ë° ê·¸ëŸ°ê²ƒì„ ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê²Œë˜ë©´ ìš°ë¦¬ê°€ íŒŒì¼ì„ ì½ê³  ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ë™ì•ˆ ê·¸ ë‹¤ìŒë¼ì¸ì— ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ì•Šì•„ ì‹œê°„ì´ ì¡°ê¸ˆ ê±¸ë¦¬ëŠ” ì¼ë“¤ì€ ì´ê²ƒì„ ì‚¬ìš©í•´ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤.
    // doing some heavy work (network, read files)
  console.log('doing something...');
    //ë§Œì•½ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì‚¬ìš©ìžê°€ ìš”êµ¬í• ë•Œë§Œ ì“°ëŠ”ê±°ë©´ ì¦‰ ì‚¬ìš©ìžê°€ ë²„íŠ¼ì„ ëˆŒë €ì„ë•Œ ë„¤íŠ¸ì›Œí¬ë¥¼ ìš”êµ¬í•˜ëŠ”ê±°ë©´ ì‚¬ìš©ìžê°€ ìš”êµ¬í•˜ì§€ë„ ì•Šì•˜ëŠ”ë° ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ê°€ ìž‘ìš©í• ìˆ˜ë„ ìžˆëŠ”ë° ì´ë•Œ Promiseì•ˆì— ê·¸ ì•ˆì— ì „ë‹¬í•œ executeor callback(ê°ì²´ì•ˆì˜ í•¨ìˆ˜method)ë°”ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ì´ì ì„ ìœ ì˜í•´ì•¼í•œë‹¤.
    
//ìš°ë¦¬ê°€ ì›í•˜ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ 2ì´ˆì •ë„ ìžˆë‹¤ê°€ ì§„í–‰ë˜ê²Œ ë§Œë“ ë‹¤.
    
  setTimeout(() => {
  resolve('ellie');   //ì„±ê³µì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°›ì•„ ì˜¤ëŠ” ê²ƒ.
    // reject(new Error('no network')); //ë¬¸ì œê°€ ìƒê²¼ì„ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒ.
  }, 2000);
});

// 2. Consumers: then, catch, finally
promise //  ê°’ì´ ì •ìƒì ìœ¼ë¡œ ìž˜ ìˆ˜í–‰ì´ ëœë‹¤ë©´ ê°’ì„ ë°›ì•„ì™€ì„œ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬í•´ ì£¼ë©´ ë©ë‹ˆë‹¤. 
//value ê°’ì€  promiseê°€ ìž˜ ìˆ˜í–‰ì´ ë˜ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ resolve ì½œë°±í•¨ìˆ˜ì—ì„œ ì „ë‹¬ëœ ì´ ì•¨ë¦¬ë¼ëŠ” ê°’ì„ ì „ë‹¬í•´ì¤€ë‹¤.
//ë§Œì•½ ìš°ë¦¬ê°€ ë„¤íŠ¸ì›Œí¬ë¥¼ í•˜ë‹¤ê°€ ë¬´ì–¸ê°€ì— ì‹¤íŒ¨ë¥¼ í–ˆì„ë•Œ  rejectë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ë³´í†µì€ ì—ëŸ¬ë¼ëŠ” ì˜¤ë¸Œì íŠ¸ë¡œ ê°’ì„ ì „ë‹¬í•œë‹¤.
  .then(value => {
    console.log(value);
  })
  .catch(error => {
    console.log(error);
  })
  .finally(() => {
    console.log('finally');
  });  //ì„±ê³µí•˜ê±°ë‚˜ ì‹¤íŒ¨í•˜ê±°ë‚˜ ìƒê´€ì—†ì´ ë¬´ì¡°ê±´ ë§ˆì§€ë§‰ì— í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜ì´ë‹¤.

// 3. Promise chaining
const fetchNumber = new Promise((resolve, reject) => {
  setTimeout(() => resolve(1), 1000);
});

fetchNumber
//thenì€ ê°’ì„ ë°”ë¡œ ì „ë‹¬í• ìˆ˜ë„ ìžˆê³  Promiseë¥¼ ì „ë‹¬í•´ì¤˜ë„ ëœë‹¤. (ìœ ì˜í• ê²ƒ!)
  .then(num => num * 2)
  .then(num => num * 3)
  .then(num => {
    return new Promise((resolve, reject) => {
      setTimeout(() => resolve(num - 1), 1000);
    });
  })
  .then(num => console.log(num));

// 4. Error Handling
const getHen = () =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve('ðŸ“'), 1000);
  });
const getEgg = hen =>
  new Promise((resolve, reject) => {
    setTimeout(() => reject(new Error(`error! ${hen} => ðŸ¥š`)), 1000);
  });
const cook = egg =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => ðŸ³`), 1000);
  });

getHen()//
//.then(hen => getEgg(hen))
//.then(egg => cook(egg))
//.then(meal => console.log(meal));
  .then(getEgg)
  .catch(error => {
    return 'BB'
})
  .then(cook)
  .then(console.log)
  .catch(console.log);
  
